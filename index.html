<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AU Smart Rego Checker</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    input, button { font-size: 1.2rem; padding: 0.5rem; margin-top: 1rem; width: 100%; }
    ul { margin-top: 1rem; }
    li { margin-bottom: 0.5rem; }
  </style>
</head>
<body>
  <h1>Smart Vehicle Registration Checker (Australia)</h1>
  <p>Enter your number plate below. If we can detect the state, we’ll redirect you there. If not, you can choose.</p>

  <input type="text" id="regoInput" placeholder="e.g. AXH950">
  <button onclick="checkRego()">Check Registration</button>
  <button onclick="copyRego()">Copy Rego</button>

  <div id="result" style="margin-top: 2rem;"></div>

  <script>
    const states = {
      NSW: {
        url: "https://check-registration.service.nsw.gov.au/?isLoginRequired=true",
        pattern: /^[A-Z]{1,3}\d{1,4}$/
      },
      VIC: {
        url: "https://www.vicroads.vic.gov.au/registration/buy-sell-or-transfer-a-vehicle/check-vehicle-registration/vehicle-registration-enquiry",
        pattern: /^[A-Z]{3}\d{3}$/
      },
      QLD: {
        url: "https://www.service.transport.qld.gov.au/checkrego/public/Welcome.xhtml",
        pattern: /^[0-9]{3}[A-Z]{3}$|^[A-Z]{3}[0-9]{3}$/
      },
      SA: {
        url: "https://account.ezyreg.sa.gov.au/account/check-registration.htm",
        pattern: /^[A-Z]{3}\d{3}$/
      },
      WA: {
        url: "https://online.transport.wa.gov.au/webExternal/registration/",
        pattern: /^[0-9]{1,6}$|^[A-Z]{1,3}\d{1,3}$/
      },
      TAS: {
        url: "https://www.transport.tas.gov.au/MRSWebInterface/public/regoLookup/registrationLookup.xhtml",
        pattern: /^[A-Z]{2,3}\d{1,3}$/
      },
      ACT: {
        url: "https://rego.act.gov.au/regosoawicket/public/reg/FindRegistrationPage",
        pattern: /^[Y]{1}[A-Z]{2}\d{2,3}$|^[A-Z]{3}\d{3}$/
      },
      NT: {
        url: "https://nt.gov.au/driving/rego/existing-nt-registration/rego-check",
        pattern: /^[A-Z]{1,3}\d{1,4}$/
      }
    };

    function checkRego() {
      const raw = document.getElementById('regoInput').value.trim().toUpperCase();
      const result = document.getElementById('result');
      result.innerHTML = "";

      if (!raw || raw.length < 2) {
        result.innerHTML = "<p style='color:red;'>Please enter a valid registration number.</p>";
        return;
      }

      const matches = Object.entries(states)
        .filter(([_, info]) => info.pattern.test(raw))
        .map(([state, info]) => ({ state, url: info.url }));

      if (matches.length === 0) {
        result.innerHTML = `<p>We couldn’t detect a matching state format. Please choose your state below:</p>`;
        result.innerHTML += makeStateList(Object.entries(states), raw);
        return;
      }

      if (matches.length === 1) {
        const { state, url } = matches[0];
        result.innerHTML = `<p>Detected <strong>${state}</strong> plate format. Redirecting...</p>`;
        setTimeout(() => {
          window.open(url, "_blank");
        }, 1000);
        return;
      }

      result.innerHTML = `<p>This plate matches multiple states. Please choose the correct one:</p>`;
      result.innerHTML += makeStateList(matches.map(m => [m.state, m.url]), raw);
    }

    function makeStateList(list, rego) {
      let html = "<ul>";
      list.forEach(([state, url]) => {
        html += `<li><a href="${url}" target="_blank">${state} Rego Check</a></li>`;
      });
      html += "</ul>";
      return html;
    }

    function copyRego() {
      const regoInput = document.getElementById('regoInput');
      regoInput.select();
      regoInput.setSelectionRange(0, 99999); // For mobile devices

      navigator.clipboard.writeText(regoInput.value).then(() => {
        alert("Registration number copied to clipboard.");
      }, () => {
        alert("Failed to copy registration number.");
      });
    }
  </script>
</body>
</html>

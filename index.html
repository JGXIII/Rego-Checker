<script>
  const stateLinks = {
    VIC: "https://www.vicroads.vic.gov.au/registration/buy-sell-or-transfer-a-vehicle/check-vehicle-registration/vehicle-registration-enquiry",
    NSW: "https://check-registration.service.nsw.gov.au/?isLoginRequired=true",
    QLD: "https://www.service.transport.qld.gov.au/checkrego/application/VehicleSearch.xhtml?dswid=-124",
    SA: "https://account.ezyreg.sa.gov.au/account/check-registration.htm#error=login_required&state=f766405e-5748-4874-84dd-25721daa5b10",
    WA: "https://online.transport.wa.gov.au/webExternal/registration/",
    TAS: "https://www.transport.tas.gov.au/MRSWebInterface/public/regoLookup/registrationLookup.xhtml",
    ACT: "https://rego.act.gov.au/regosoawicket/public/reg/FindRegistrationPage",
    NT: "https://nt.gov.au/driving/rego/existing-nt-registration/rego-check"
  };

  const letterToState = {
    V: "VIC",
    N: "NSW",
    Q: "QLD",
    S: "SA",
    W: "WA",
    T: "TAS",
    A: "ACT",
    X: "NT"
  };

  const input = document.getElementById("regoInput");
  const result = document.getElementById("result");

  function openAndFocus(url) {
    const newWindow = window.open(url, "_blank");
    if (newWindow) {
      newWindow.focus();
    }
  }

  function buildStateList(rego) {
    if (!rego || rego.length < 2) {
      result.innerHTML = "";
      return;
    }
    let html = '<h3>Click a state below to check your rego:</h3><ul>';
    for (const [state, url] of Object.entries(stateLinks)) {
      // Wrap in a function to open and focus on click
      html += `<li onclick="openAndFocus('${url}')">${state} Rego Check</li>`;
    }
    html += '</ul>';
    result.innerHTML = html;
  }

  input.addEventListener("input", () => {
    let val = input.value.trim().toUpperCase();

    let regoOnly = val;
    let lastSpaceIndex = val.lastIndexOf(" ");
    let possibleLetter = "";
    if (lastSpaceIndex > -1) {
      possibleLetter = val.slice(lastSpaceIndex + 1);
      if (possibleLetter.length === 1 && letterToState[possibleLetter]) {
        regoOnly = val.slice(0, lastSpaceIndex);
      }
    }

    if (!regoOnly || regoOnly.length < 2) {
      result.innerHTML = "";
      return;
    }

    navigator.clipboard.writeText(regoOnly).catch(() => {});

    if (possibleLetter && letterToState[possibleLetter]) {
      const state = letterToState[possibleLetter];
      const url = stateLinks[state];
      if (url) {
        openAndFocus(url);
        input.value = "";
        result.innerHTML = "";
        return;
      }
    }

    buildStateList(regoOnly);
  });
</script>
